# Phase 2 [2-4] AI 추천 프롬프트 테스트 및 학습

> 실제 구현 전에 AI 프롬프트가 올바르게 동작하는지 테스트합니다.

## 📋 테스트 목표

Google Gemini AI에게 실제 옷 데이터를 바탕으로 스타일 추천을 요청하고,
응답이 올바른 JSON 형식인지 확인합니다.

---

## 🧪 Test Case 1: 기본 추천 (3개 옷)

### 시나리오
사용자가 3개의 기본적인 옷을 가지고 있습니다:

```json
옷1: 검정 후드티
- 색상: 검정 (#000000)
- 패턴: 무지
- 재질: 코튼
- 스타일: ["캐주얼"]
- 시즌: ["봄", "가을", "겨울"]
- 용도: ["일상", "출근"]
- 격식도: 2/10

옷2: 회색 셔츠
- 색상: 회색 (#808080)
- 패턴: 무지
- 재질: 코튼
- 스타일: ["캐주얼", "포멀"]
- 시즌: ["사계절"]
- 용도: ["출근", "데이트"]
- 격식도: 5/10

옷3: 검정 청바지
- 색상: 검정 (#000000)
- 패턴: 무지
- 재질: 데님
- 스타일: ["캐주얼"]
- 시즌: ["사계절"]
- 용도: ["일상", "출근"]
- 격식도: 3/10
```

### 기대 추천 결과

**추천 1순위**: 검정 후드티 + 검정 청바지 + 회색 셔츠
```
이유: 모노톤 조합 (검정+회색)으로 세련되고,
     모두 캐주얼 스타일로 통일감 있음,
     무지 패턴만 사용해서 깔끔함
점수: 9/10
```

**추천 2순위**: 회색 셔츠 + 검정 청바지
```
이유: 중성적 색감의 조합,
     캐주얼 스타일 통일,
     포멀한 느낌도 가능
점수: 8/10
```

**추천 3순위**: 검정 후드티 + 회색 셔츠 + 검정 청바지
```
이유: 모든 옷을 포함한 조합,
     모노톤 + 격식도 다양성
점수: 7/10
```

---

## 🧪 Test Case 2: 다양한 스타일 (10개 옷)

### 시나리오
다양한 스타일의 옷을 가진 사용자:

```json
옷들:
1. 검정 후드티 (캐주얼, 검정, 무지)
2. 흰색 셔츠 (포멀, 흰색, 무지)
3. 검정 청바지 (캐주얼, 검정, 무지)
4. 베이지 치노바지 (캐주얼, 베이지, 무지)
5. 빨강 니트 (캐주얼, 빨강, 무지)
6. 파란 스트라이프 셔츠 (포멀, 파랑, 스트라이프)
7. 갈색 가죽 자켓 (클래식, 갈색, 무지)
8. 흰색 스니커즈 (캐주얼, 흰색, 무지)
9. 검정 구두 (포멀, 검정, 무지)
10. 카키 슬랙스 (포멀, 카키, 무지)
```

### 기대 추천 결과

**추천 1순위**: 검정 후드티 + 검정 청바지 + 흰색 스니커즈
```
점수: 9.5/10
이유: 완벽한 모노톤 조합,
     캐주얼 스타일 통일,
     무지 패턴만 사용,
     현대적이고 세련된 느낌
```

**추천 2순위**: 흰색 셔츠 + 카키 슬랙스 + 검정 구두
```
점수: 8.5/10
이유: 포멀한 스타일 통일,
     보색 조합 (흰색+카키),
     비즈니스 룩에 완벽함,
     격식도 높음
```

**추천 3순위**: 갈색 가죽 자켓 + 베이지 치노바지 + 흰색 스니커즈
```
점수: 8/10
이유: 따뜻한 톤 통일 (갈색+베이지),
     캐주얼 스타일,
     가을/겨울에 좋음,
     편한 느낌
```

---

## 🔍 프롬프트 평가 기준 분석

### 1️⃣ 색상 조화 검증

**좋은 조합**:
- ✅ 검정 + 회색 + 흰색 (모노톤)
- ✅ 파란색 + 주황색 (보색)
- ✅ 갈색 + 베이지 (인접색)

**피해야 할 조합**:
- ❌ 빨강 + 초록 + 파랑 (너무 많은 색상)
- ❌ 밝은 핑크 + 어두운 갈색 (톤 충돌)

### 2️⃣ 스타일 통일감 검증

```
같은 스타일끼리 조합:
✅ 캐주얼 + 캐주얼 = 완벽함
✅ 포멀 + 포멀 = 완벽함

다른 스타일 조합:
⚠️ 캐주얼 + 포멀 = 스타일 믹스 (신중함)
⚠️ 클래식 + 캐주얼 = 보정 필요

결론: 평가자는 같은 스타일의 옷들을 먼저 추천
```

### 3️⃣ 패턴 균형 검증

```
패턴 조합 규칙:
✅ 무지 + 무지 = 깔끔함
✅ 무지 + 패턴 (한 가지) = 조화로움
⚠️ 패턴 + 패턴 = 신중함 (크기/색감이 다를 수 있음)
❌ 패턴 3개 이상 = 너무 복잡함

결론: 무지 옷들을 기본으로, 패턴은 1개 정도만
```

### 4️⃣ 격식도 유사성 검증

```
격식도 스케일 (1-10):
1-2: 운동복, 캐주얼
3-5: 일상복, 데일리
6-7: 비즈니스 캐주얼
8-10: 정장

같은 범위 내에서 조합:
✅ 1 + 2 + 3 = 모두 캐주얼 (통일)
✅ 8 + 9 + 10 = 모두 정장 (통일)
⚠️ 2 + 5 + 7 = 너무 차이남 (어색)
❌ 2 + 10 = 극단적 차이

결론: 격식도 범위 3 이내로 제한
```

### 5️⃣ 시즌 조화 검증

```
현재 시즌이 "가을"이라고 가정:

✅ 가을 옷 + 가을 옷
   - 따뜻한 톤 (갈색, 버그온드, 주황)
   - 가을 옷감 (니트, 벨벳)

✅ 사계절 옷 + 가을 옷
   - 기본 옷들

❌ 여름 옷 + 가을 옷
   - 밝은 파스텔 + 어두운 톤은 어색

결론: 같은 시즌 또는 사계절 옷들을 우선
```

### 6️⃣ 용도 조화 검증

```
용도 분류:
- 일상: 편한, 캐주얼
- 출근: 정장, 포멀
- 데이트: 세련, 모던
- 운동: 스포츠웨어
- 파티: 화려, 포멀

조합 규칙:
✅ 일상 + 일상 = 최적
✅ 출근 + 출근 = 최적
⚠️ 일상 + 출근 = 다목적 (가능)
❌ 운동 + 파티 = 어울리지 않음

결론: 같은 용도 옷들을 먼저 추천
```

---

## 🚀 실제 구현 테스트 순서

### Step 1: 회원가입 및 로그인
```bash
# 회원가입
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "name": "테스트유저"
  }'

# 로그인 (토큰 획득)
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

응답에서 `token` 복사합니다.

### Step 2: 의류 3개 이상 업로드

```bash
TOKEN="your-jwt-token"

# 1. 검정 후드티 업로드
curl -X POST http://localhost:3001/api/clothing/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "image=@shirt1.jpg" \
  -F "name=검정 후드티" \
  -F "brand=Nike" \
  -F "categoryId=cat-1"

# 2. 회색 셔츠 업로드
curl -X POST http://localhost:3001/api/clothing/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "image=@shirt2.jpg" \
  -F "name=회색 셔츠" \
  -F "brand=Uniqlo" \
  -F "categoryId=cat-1"

# 3. 검정 청바지 업로드
curl -X POST http://localhost:3001/api/clothing/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "image=@pants.jpg" \
  -F "name=검정 청바지" \
  -F "brand=Levi's" \
  -F "categoryId=cat-2"
```

### Step 3: 추천 API 호출

```bash
curl -X GET http://localhost:3001/api/recommendations/style \
  -H "Authorization: Bearer $TOKEN"
```

### 기대 응답

```json
{
  "success": true,
  "message": "스타일 추천 생성 완료",
  "data": {
    "totalClothes": 3,
    "recommendations": [
      {
        "rank": 1,
        "score": 9.5,
        "reason": "모노톤 조합으로 세련되고...",
        "combination": [
          {
            "id": "clothing-id-1",
            "name": "검정 후드티",
            "color": "검정",
            "pattern": "무지",
            "style": ["캐주얼"]
          },
          {
            "id": "clothing-id-2",
            "name": "회색 셔츠",
            "color": "회색",
            "pattern": "무지",
            "style": ["캐주얼"]
          },
          {
            "id": "clothing-id-3",
            "name": "검정 청바지",
            "color": "검정",
            "pattern": "무지",
            "style": ["캐주얼"]
          }
        ]
      }
    ]
  }
}
```

---

## 🔧 트러블슈팅

### 문제 1: "최소 3개 이상의 옷이 필요합니다" 에러

**원인**: 데이터베이스에 의류가 3개 미만

**해결책**:
```bash
# 의류 목록 확인
curl -X GET http://localhost:3001/api/clothing \
  -H "Authorization: Bearer $TOKEN"

# 부족하면 추가 업로드
```

### 문제 2: AI가 Invalid JSON 반환

**원인**: Gemini API가 마크다운 형식으로 응답

**해결책**: 코드에서 마크다운 제거 처리됨
```typescript
// 자동으로 처리됨
const cleanText = responseText
  .replace(/```json\n?/g, '')
  .replace(/```\n?/g, '')
  .trim();
```

### 문제 3: AI가 존재하지 않는 옷 이름 추천

**원인**: AI가 옷 이름을 잘못 이해

**해결책**: 프롬프트에서 옷 이름을 더 명확하게 전달
```typescript
// 프롬프트 개선 예정
const clothingList = clothes
  .map((c, idx) => `${idx + 1}. ${c.name} (색상: ${c.primaryColor}, ...)`);
```

---

## 📊 평가 매트릭스

프롬프트가 올바르게 평가하는지 확인하기 위한 체크리스트:

- [ ] **색상 조화**: 모노톤 조합이 높은 점수?
- [ ] **스타일 통일**: 같은 스타일이 우대?
- [ ] **패턴 균형**: 무지만 사용 조합이 최고?
- [ ] **격식도**: 유사한 격식도 조합이 높음?
- [ ] **시즌**: 같은 시즌 조합 우대?
- [ ] **용도**: 같은 용도 조합 우대?
- [ ] **추천 개수**: 정확히 3개?
- [ ] **JSON 형식**: 올바른 구조?
- [ ] **점수 범위**: 1-10 범위?
- [ ] **이유 설명**: 자세하고 이해하기 쉬운가?

---

## 🎓 학습 포인트

### AI 프롬프트 엔지니어링

좋은 프롬프트의 특징:

1. **역할 정의**: "당신은 패션 스타일리스트입니다"
2. **구체적인 기준**: 평가 기준을 명확히 (6가지)
3. **예제 제공**: 좋은/나쁜 조합 예시
4. **응답 형식 명시**: 정확한 JSON 형식
5. **제약 조건**: "유효한 JSON만"

### 색상 심리학

추천 시스템이 고려해야 할 색상 규칙:

- **모노톤**: 세련되고 우아함
- **보색**: 생기있고 대비 강함
- **인접색**: 조화롭고 자연스러움
- **분할-보색**: 현대적이고 세련됨

---

## 다음 단계

1. ✅ 프롬프트 검증
2. ✅ API 구현
3. ⏳ 실제 테스트 (다음 단계)
4. ⏳ 블로그 포스트 작성
5. ⏳ PR 생성

모든 파일이 준비되었습니다!
이제 백엔드를 실행해서 실제로 테스트할 준비가 되었습니다. 🚀
