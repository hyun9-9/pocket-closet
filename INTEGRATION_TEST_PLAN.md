# Phase 3 [3-2] UploadPage 통합 테스트 플랜

## 🎯 테스트 목표

백엔드 API와 프론트엔드 UploadPage가 정상적으로 연동되는지 확인

---

## 🔧 테스트 환경 설정

### 준비 사항

1. **백엔드 실행**:
   ```bash
   cd backend
   npm run dev
   # http://localhost:3001 에서 실행
   ```

2. **프론트엔드 실행**:
   ```bash
   cd frontend
   npm run dev
   # http://localhost:5173 에서 실행
   ```

3. **테스트 이미지 준비**:
   - 작은 이미지: < 5MB (JPG, PNG, WebP)
   - 큰 이미지: > 10MB (테스트용)
   - 지원하지 않는 형식: GIF, BMP 등

4. **테스트 사용자**:
   - 테스트 계정 생성 및 로그인

---

## 📋 테스트 시나리오

### **Test Case 1: 성공적인 의류 업로드**

**시나리오**: 정상적인 파일과 모든 필수 데이터를 입력하여 업로드

**전제 조건**:
- 로그인된 상태
- 유효한 이미지 파일 준비 (< 10MB, JPG/PNG/WebP)

**단계별 절차**:
```
1. /upload 페이지로 이동
2. 이미지 파일 드래그 앤 드롭 (또는 클릭으로 선택)
3. 미리보기 확인
4. 의류 이름 입력: "검정 후드집업"
5. 브랜드 입력 (선택): "Nike"
6. 카테고리 선택: "상의"
7. "업로드" 버튼 클릭
8. 로딩 표시 확인
```

**예상 결과**:
- ✅ 상태 코드 201
- ✅ 응답 데이터:
  ```json
  {
    "success": true,
    "message": "의류 업로드 및 분석 완료",
    "data": {
      "id": "cloxxxxxx",
      "name": "검정 후드집업",
      "primaryColor": "#000000",
      "metadata": {
        "pattern": "무지",
        "material": "코튼",
        "style": ["캐주얼"],
        "season": ["봄", "가을", "겨울"],
        "occasion": ["일상"]
      }
    }
  }
  ```
- ✅ 프론트엔드: 성공 UI 표시
- ✅ 2초 후 /wardrobe로 자동 이동
- ✅ 데이터베이스: 새 의류 레코드 생성 확인

**검증 방법**:
1. 브라우저 DevTools → Network 탭에서 응답 확인
2. 브라우저 Console에서 "업로드 성공:" 메시지 확인
3. 성공 UI 스크린샷 캡처
4. /wardrobe 페이지에서 업로드된 의류 확인

**Pass/Fail 기준**:
- 상태 코드 201
- 응답 데이터 구조 정확
- 프론트엔드 UI 정상 작동
- 데이터베이스 저장 확인

---

### **Test Case 2: 파일 없이 업로드 시도**

**시나리오**: 파일을 선택하지 않고 업로드 버튼 클릭

**전제 조건**:
- /upload 페이지 열림
- 파일 미선택 상태

**단계별 절차**:
```
1. 파일 선택 없이 업로드 버튼 클릭 시도
   (또는 파일 선택 후 리셋 후 업로드)
```

**예상 결과**:
- ✅ 프론트엔드: "파일을 선택해주세요" 에러 메시지
- ✅ API 호출 안 됨 (네트워크 탭 확인)
- ✅ 업로드 버튼 비활성화 상태 유지

**Pass/Fail 기준**:
- 에러 메시지 표시
- API 호출 안 됨

---

### **Test Case 3: 의류 이름 미입력**

**시나리오**: 파일과 카테고리는 선택했지만 의류 이름 미입력

**전제 조건**:
- 파일 선택 완료
- 의류 이름 필드 비어 있음

**단계별 절차**:
```
1. 파일 선택
2. 의류 이름 필드 비우기
3. 카테고리 선택: "상의"
4. 업로드 버튼 클릭 시도
```

**예상 결과**:
- ✅ 프론트엔드: "의류 이름을 입력해주세요" 에러 메시지
- ✅ 업로드 버튼 비활성화
- ✅ API 호출 안 됨

**Pass/Fail 기준**:
- 에러 메시지 표시
- 업로드 버튼 비활성화
- API 호출 안 됨

---

### **Test Case 4: 카테고리 미선택**

**시나리오**: 파일과 이름은 입력했지만 카테고리 미선택

**전제 조건**:
- 파일 선택 완료
- 의류 이름 입력 완료
- 카테고리 선택 안 됨 (드롭다운 기본값 제외)

**단계별 절차**:
```
1. 파일 선택
2. 의류 이름 입력: "반팔 티셔츠"
3. 카테고리 드롭다운 확인
4. 업로드 버튼 클릭
```

**예상 결과**:
- ✅ 기본 카테고리 'top'으로 업로드
- ✅ 또는 카테고리가 비어 있으면 에러

**Pass/Fail 기준**:
- 기본값으로 업로드 되거나 에러 메시지 표시

---

### **Test Case 5: 지원하지 않는 이미지 형식**

**시나리오**: GIF, BMP 등 지원하지 않는 형식 선택

**전제 조건**:
- GIF 또는 BMP 파일 준비

**단계별 절차**:
```
1. GIF 파일 드래그 앤 드롭
2. 에러 메시지 확인
```

**예상 결과**:
- ✅ 프론트엔드: "JPG, PNG, WebP 파일만 업로드 가능합니다" 에러
- ✅ 미리보기 미표시
- ✅ API 호출 안 됨

**Pass/Fail 기준**:
- 에러 메시지 표시
- 미리보기 미표시

---

### **Test Case 6: 파일 크기 초과**

**시나리오**: 10MB 초과 파일 선택

**전제 조건**:
- 10MB 초과 이미지 파일 준비

**단계별 절차**:
```
1. 10MB 초과 파일 선택
2. 에러 메시지 확인
```

**예상 결과**:
- ✅ 프론트엔드: "파일 크기는 10MB 이하여야 합니다" 에러
- ✅ 미리보기 미표시

**Pass/Fail 기준**:
- 에러 메시지 표시
- 미리보기 미표시

---

### **Test Case 7: 로그인하지 않은 상태에서 업로드 시도**

**시나리오**: 토큰 없이 업로드 요청

**전제 조건**:
- 로그아웃 상태 (토큰 삭제)
- /upload 페이지 접근 가능 (라우팅 체크)

**단계별 절차**:
```
1. localStorage에서 토큰 삭제 (DevTools)
2. /upload 페이지 이동 또는 새로고침
3. 페이지 이동 확인
```

**예상 결과**:
- ✅ /login 페이지로 리다이렉트
- 또는 ProtectedRoute에서 차단

**Pass/Fail 기준**:
- /login으로 리다이렉트

---

### **Test Case 8: 만료된 토큰으로 업로드 시도**

**시나리오**: 만료된 JWT 토큰으로 업로드

**전제 조건**:
- 토큰은 있지만 만료된 상태

**단계별 절차**:
```
1. 로그인 후 토큰 만료 대기
2. 파일 선택 및 업로드 시도
3. 에러 메시지 확인
```

**예상 결과**:
- ✅ 상태 코드 401
- ✅ 프론트엔드: 에러 메시지 표시 또는 /login으로 리다이렉트

**Pass/Fail 기준**:
- 401 에러 처리
- 사용자 피드백 표시

---

## 🔍 검증 체크리스트

### 프론트엔드 검증

#### 파일 선택
- [ ] 드래그 앤 드롭으로 파일 선택 가능
- [ ] 클릭으로 파일 선택 가능
- [ ] isDragging 상태에 따라 UI 변경 (배경색)

#### 파일 검증
- [ ] JPG 파일 수용
- [ ] PNG 파일 수용
- [ ] WebP 파일 수용
- [ ] GIF 파일 거부 및 에러 메시지
- [ ] 파일 크기 10MB 확인
- [ ] 파일 크기 초과 시 에러 메시지

#### 미리보기
- [ ] FileReader로 미리보기 생성
- [ ] 이미지 올바르게 표시
- [ ] 파일명과 크기 표시

#### 폼 필드
- [ ] 의류 이름 입력 필드
- [ ] 브랜드 입력 필드 (선택사항 표시)
- [ ] 카테고리 선택 드롭다운
- [ ] 필드별 필수 표시 (*)

#### 업로드
- [ ] 필수 필드 검증 (이름, 카테고리)
- [ ] 업로드 버튼 활성화/비활성화
- [ ] 로딩 상태 표시 (스핀 아이콘)
- [ ] 로딩 중 버튼 비활성화

#### 성공 UI
- [ ] 성공 메시지 표시
- [ ] AI 분석 결과 표시 (색상, 패턴 등)
- [ ] 2초 후 /wardrobe로 자동 이동

#### 에러 처리
- [ ] 에러 메시지 표시 (빨간색)
- [ ] 에러 메시지 조건부 표시
- [ ] 재선택 버튼으로 초기화 가능

### 백엔드 검증

#### API 요청
- [ ] POST /api/clothing/upload 호출
- [ ] Content-Type: multipart/form-data 설정
- [ ] Authorization 헤더 포함 (Bearer 토큰)
- [ ] image, name, categoryId 필드 포함

#### 파일 처리
- [ ] Multer로 파일 파싱
- [ ] 파일 MIME 타입 확인
- [ ] 파일 크기 확인 (10MB)
- [ ] Sharp로 이미지 처리 (1024x1024, JPEG)

#### AI 분석
- [ ] Google Gemini API 호출
- [ ] JSON 응답 파싱
- [ ] 필드 추출: primaryColor, pattern, material, style, season, occasion

#### 데이터베이스
- [ ] MyClothing 테이블에 레코드 생성
- [ ] userId, name, categoryId 저장
- [ ] AI 분석 결과 저장
- [ ] 타임스탬프 (createdAt, updatedAt) 자동 설정

#### 응답 처리
- [ ] 상태 코드 201 (Created)
- [ ] 응답 JSON 구조 정확
- [ ] id, name, primaryColor, metadata 포함
- [ ] metadata.pattern, material, style, season, occasion 포함

#### 에러 처리
- [ ] 파일 없음 → 400
- [ ] 필수 필드 없음 → 400
- [ ] 지원하지 않는 형식 → 400
- [ ] 파일 크기 초과 → 400
- [ ] 인증 실패 → 401
- [ ] 이미지 처리 오류 → 500
- [ ] AI 분석 오류 → 500

### 통합 검증

#### 요청-응답 흐름
- [ ] 프론트엔드에서 올바른 데이터 전송
- [ ] 백엔드에서 올바른 데이터 처리
- [ ] 응답 데이터 프론트엔드에서 올바르게 파싱
- [ ] UI 상태 업데이트

#### 데이터 일치성
- [ ] 업로드된 의류 이름이 DB에 저장된 이름과 일치
- [ ] 업로드된 카테고리가 DB에 저장된 값과 일치
- [ ] AI 분석 결과가 DB에 저장됨

#### 사용자 경험
- [ ] 전체 플로우가 자연스러움
- [ ] 에러 발생 시 사용자가 이해할 수 있는 메시지
- [ ] 로딩 상태가 명확함
- [ ] 성공 후 자동 이동 시간이 적절함

---

## 📊 테스트 실행 순서

1. **기본 기능 테스트**:
   - Test Case 1: 성공 케이스 (가장 중요)

2. **클라이언트 검증 테스트**:
   - Test Case 2: 파일 없음
   - Test Case 3: 의류 이름 미입력
   - Test Case 4: 카테고리 미선택

3. **파일 검증 테스트**:
   - Test Case 5: 지원하지 않는 형식
   - Test Case 6: 파일 크기 초과

4. **인증 테스트**:
   - Test Case 7: 로그인하지 않은 상태
   - Test Case 8: 만료된 토큰

---

## 🐛 발견된 문제 처리

### Issue 1: categoryId 미전달
- **상태**: ✅ 해결됨
- **내용**: 원래 코드에서 categoryId가 백엔드로 전달되지 않음
- **해결**: UploadPage.tsx 수정, categoryId 필드 추가

### Issue 2: 필수 필드 검증
- **상태**: ✅ 해결됨
- **내용**: 프론트엔드에서 name 필드 검증 필요
- **해결**: handleUpload에서 clothingName 검증 추가

---

## 📝 테스트 결과 기록

### Test Case 1: 성공적인 의류 업로드
- **실행 날짜**:
- **결과**:
- **상태 코드**:
- **에러**:
- **Notes**:

### Test Case 2-8
- (각 케이스별로 동일한 형식으로 기록)

---

## ✅ 완료 기준

모든 Test Case가 Pass되어야 Phase 3 [3-2]가 완료됨:
- [ ] Test Case 1: Pass
- [ ] Test Case 2: Pass
- [ ] Test Case 3: Pass
- [ ] Test Case 4: Pass
- [ ] Test Case 5: Pass
- [ ] Test Case 6: Pass
- [ ] Test Case 7: Pass
- [ ] Test Case 8: Pass

---

## 🚀 다음 단계

Phase 3 [3-2] 통합 테스트 완료 후:
1. POC-72: WardrobePage 설계 블로그 작성
2. Phase 3 [3-3]: 옷장 페이지 구현 (TDD)
